@(branches: Iterable[models.Branch])(implicit request: RequestHeader)


@import components.entityState

    @buildStatus(branch: Branch) = @{
        branch.builds match {
            case head :: tail =>
                head.result match {
                    case BuildResult.SUCCESS => "success"
                    case BuildResult.FAILURE => "danger"
                    case _ => "warning"
                }
            case _ => ""
        }
    }

<div class="container">
    <table class="table sortable table-condensed">
        <thead>
            <tr>
                <th>PR</th>
                <th>Branch</th>
                <th>Name</th>
                <th>Users</th>
                <th data-defaultsort="asc">State</th>
            </tr>
        </thead>
        <tbody>
        @for(branch <- branches) {
            <tr class="role-branch @buildStatus(branch)">
                <td>
                @branch.pullRequest match {
                    case Some(pr) => {
                        <a class="btn btn-default pull-request" data-id="@pr.id" href="@pr.url">#@pr.id</a>
                    }
                    case None => {}
                }
                </td>
                <td>@branch.name</td>
                @branch.entity match {
                    case Some(entity) => {
                        <td>@entity.name</td>
                        <td class="role-users" data-value="@entity.sortedAssignments.map(_.lastName).mkString(" ")" data-user-ids="|@entity.sortedAssignments.map(_.userId).mkString("|")|">
                        @for(assignment <- entity.sortedAssignments) {
                            <span data-role="@assignment.role" class="role @if(assignment.isResponsible) {role-active} else {role-inactive}"><img data-src="holder.js/100%x180" src="@{
                                assignment.avatar
                            }30"
                            title="@assignment.role: @assignment.fullName">
                            </span>
                        }
                        </td>
                        @entityState(entity.id, entity.state)
                    }
                    case None => {
                        <td></td>
                        <td></td>
                        <td></td>
                    }
                }
            </tr>
        }
        </tbody>
    </table>
</div><!-- /.container -->
<script src="@routes.Assets.at("/javascripts/branches.js")"></script>
