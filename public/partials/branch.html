<div class="overlay" ng-click="closeView()"></div>
<div class="view">
    <div class="action-panel">
        <div class="caption">
            <entity-title entity="branch.entity"></entity-title>
            <h2 ng-show="!branch.entity">{{branchName}}</h2>
        </div>


        <div class="action-list">
            <div ng-repeat="build in builds | orderBy:'-number'">
                <div class="date">{{build.timeStamp | date:'M/d/yy HH:mm' }}</div>
                <div class="avatar">
                    <img title="Jenkins" src="/assets/images/jenkins.png" style="width: 32px; height: 32px;">
                </div>
                <div class="description">
                    <div class="panel-group">
                        <div class="panel {{build.status | status}}">
                            <div class="panel-heading" ng-init="isCollapsed = !$first; build.cachedNode = $index ? null : build.node">
                                <div class="dropdown">
                                    <button data-toggle="dropdown" class="btn jenkins {{build.status | status}} dropdown-toggle">{{build.status}}</button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="status success" href="" ng-click="toggleBuild(branchName, build.number)">{{build.toggled && 'Make red' || 'Make green'}}</a>
                                        </li>
                                    </ul>
                                </div>
                                <h4 class="panel-title toggle-state">
                                    <a ng-click="build.cachedNode = build.node; isCollapsed = !isCollapsed">
                                        Build #{{build.number}}
                                    </a>
                                </h4>
                            </div>
                            <div class="tree panel-collapse" ng-show="!isCollapsed">
                                <div class="panel-body">
                                    <ul>
                                        <li ng-repeat="data in [build.cachedNode]" ng-include="'/assets/partials/buildNode.html'"></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>
    <div class="info-panel">
        <div class="item" ng-show="branch.entity">
            <h4>Users</h4>
            <span ng-repeat="user in branch.entity.assignments" class="avatar">
                <img ng-src="{{user.avatar}}20">
                <span>{{user.firstName}} {{user.lastName}}</span>
            </span>
        </div>
        <div class="item" ng-show="branch.entity">
            <h4>Status</h4>
            <entity-state entity="branch.entity" type="btn"></entity-state>
        </div>
        <div class="item" ng-show="branch.pullRequest">
           <h4>Pr</h4>
           <a
               class="btn pr {{ branch.pullRequest | pullRequestStatus | status }}"
               href="{{branch.pullRequest.url}}">#{{branch.pullRequest.prId}}</a>
        </div>

        <div class="item">
            <h4>Jenkins</h4>
            <div class="dropdown">
                <a ng-show="branch.lastBuild" href="" class="jenkins btn status {{ branch.lastBuild.status | status}} dropdown-toggle" data-toggle="dropdown" title="{{branch.lastBuild.status}}">
                    {{ branch.lastBuild.timeStamp | date }}
                </a>
                <a ng-show="!branch.lastBuild" href="" class="jenkins btn status dropdown-toggle" data-toggle="dropdown">
                    Never built
                </a>
                <ul class="dropdown-menu">
                    <li ng-show="branch.lastBuild"><a href="{{branch.lastBuild.url}}" class="jenkins active">Go to Jenkins</a></li>
                    <li ng-repeat="action in branch.buildActions"><a class="jenkins" href="" ng-click="forceBuild(action)">{{action.name}}</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>